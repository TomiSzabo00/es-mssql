name: Build Docker image for AHK

on:
  push:
    paths:
      - "ahk/**"
      - "megoldas/**"
      - ".github/workflows/**"

jobs:
  build:
    runs-on: ubuntu-18.04

    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1
      - name: Build docker image
        run: |
          cd ahk
          docker build -t docker.pkg.github.com/bi-labor/mssql/lab-mssql:2019 .
      - name: Test sample solution
        run: docker run --rm -v $(pwd)/megoldas:/megoldas docker.pkg.github.com/bi-labor/mssql/lab-mssql:2019
      - name: Tag and push docker images
        run: |
          docker login docker.pkg.github.com -u ${{ github.actor }} -p ${{ secrets.GITHUB_TOKEN }}
          docker push docker.pkg.github.com/bi-labor/mssql/lab-mssql:2019
          docker logout docker.pkg.github.com
